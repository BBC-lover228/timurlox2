package main

import (
	"context"
	"fmt"
	"log"
	"net"
	"net/http"
	"os"
	"os/exec"<!doctype html>
<html lang="en">:root {
  color-scheme: dark;
  --panel: #151827;
  --accent: #ff7a18;
  --text: #f5f7ff;
  --muted: #9fa6c8;
}

body {
  margin: 0;
  min-height: 100vh;
  display: grid;
  place-items: center;
  background: #0b0d18;
  color: var(--text);
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}

.calculator {
  width: min(420px, 92vw);
  background: var(--panel);
  border-radius: 12px;
  padding: 18px;
}

.calculator--hidden {
  display: none;
}
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculator</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="start-overlay" id="start-overlay">
    <div class="start-panel">
      <h2>Welcome</h2>
      <p>Start the calculator</p>
      <button id="start-button" class="start-button">Start</button>
    </div>
  </div>

  <main class="calculator calculator--hidden">
    <header class="calculator__header">
      <h1>Calculator</h1>
      <p>Simple demo</p>
    </header>

    <section class="calculator__screen">
      <div id="expression" class="expression">0</div>
      <div id="result" class="result">0</div>
    </section>

    <section class="calculator__keys">
      <button class="key key--function" data-action="clear">C</button>
      <button class="key key--function" data-action="delete">DEL</button>
      <button class="key key--operator" data-value="/">/</button>
      <button class="key key--operator" data-value="*">*</button>

      <button class="key" data-value="7">7</button>
      <button class="key" data-value="8">8</button>
      <button class="key" data-value="9">9</button>
      <button class="key key--operator" data-value="-">-</button>

      <button class="key" data-value="4">4</button>
      <button class="key" data-value="5">5</button>
      <button class="key" data-value="6">6</button>
      <button class="key key--operator" data-value="+">+</button>

      <button class="key" data-value="1">1</button>
      <button class="key" data-value="2">2</button>
      <button class="key" data-value="3">3</button>
      <button class="key key--equals key--wide" data-action="equals">=</button>
    </section>
  </main>

  <audio id="click-sound"></audio>
  <audio id="result-sound"></audio>
  <audio id="music" loop></audio>

  <script src="app.js"></script>
</body>
</html>
	"os/signal"
	"runtime"
	"syscall"
	"time"
)

const addr = ":5173"

func main() {
	mux := http.NewServeMux()
	mux.Handle("/", http.FileServer(http.Dir("web")))

	srv := &http.Server{
		Addr:    addr,
		Handler: mux,
	}

	listener, err := net.Listen("tcp", addr)
	if err != nil {
		log.Fatalf("failed to listen on %s: %v", addr, err)
	}

	// run server
	go func() {
		if err := srv.Serve(listener); err != nil && err != http.ErrServerClosed {
			log.Fatalf("server error: %v", err)
		}
	}()

	url := fmt.Sprintf("http://localhost%s", addr)
	if err := openBrowser(url); err != nil {
		log.Printf("could not open browser: %v", err)
		log.Printf("open %s manually", url)
	}

	log.Printf("calculator running at %s (Ctrl+C to stop)", url)

	// wait for interrupt (Ctrl+C) or termination
	quit := make(chan os.Signal, 1)const expressionEl = document.getElementById("expression");
const resultEl = document.getElementById("result");
const clickSound = document.getElementById("click-sound");
const resultSound = document.getElementById("result-sound");
const music = document.getElementById("music");
const startOverlay = document.getElementById("start-overlay");
const startButton = document.getElementById("start-button");
const calculator = document.querySelector(".calculator");

let expression = "";

const playSound = (audio) => {
  if (!audio) return;
  try { audio.currentTime = 0; audio.play(); } catch (e) { /* ignore */ }
};

const updateDisplay = () => {
  expressionEl.textContent = expression || "0";
  resultEl.textContent = "0";
};

const appendValue = (value) => {
  expression += value;
  updateDisplay();
};

const deleteLast = () => {
  expression = expression.slice(0, -1);
  updateDisplay();
};

const clearAll = () => {
  expression = "";
  updateDisplay();
};

const resolveExpression = () => {
  try {
    const res = eval(expression || "0"); // simple demo only
    resultEl.textContent = String(res);
    playSound(resultSound);
  } catch (e) {
    resultEl.textContent = "Err";
  }
};

const handleButton = (button) => {
  playSound(clickSound);
  const action = button.dataset.action;
  const value = button.dataset.value;
  if (action === "clear") return clearAll();
  if (action === "delete") return deleteLast();
  if (action === "equals") return resolveExpression();
  if (value) appendValue(value);
};

const init = () => {
  document.querySelectorAll(".key").forEach((button) => {
    button.addEventListener("click", () => handleButton(button));
  });

  startButton.addEventListener("click", () => {
    playSound(clickSound);
    startOverlay.classList.add("start-overlay--hidden");
    calculator.classList.remove("calculator--hidden");
    if (music && music.paused) { music.volume = 0.4; music.play(); }
  });

  updateDisplay();
};

init();
	signal.Notify(quit, os.Interrupt, syscall.SIGTERM)
	<-quit

	// graceful shutdown
	ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
	defer cancel()
	if err := srv.Shutdown(ctx); err != nil {
		log.Printf("shutdown error: %v", err)
	}
	log.Println("server stopped")
}

func openBrowser(url string) error {
	var cmd *exec.Cmd
	switch runtime.GOOS {
	case "darwin":
		cmd = exec.Command("open", url)
	case "windows":
		cmd = exec.Command("rundll32", "url.dll,FileProtocolHandler", url)
	default:
		cmd = exec.Command("xdg-open", url)
	}
	return cmd.Start()
}
